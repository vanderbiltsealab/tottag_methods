---
title: "TotTag Methods Analyses"
output: html_notebook
---

# SET UP ENVIRONMENT
```{r}

library(readr)
library(tidyverse)
library(anytime)
library(lubridate)
library(e1071)
library(patchwork)
library(pastecs)
library(DescTools)

# Display options
options(scipen = 999)

```

# READ IN AND REFORMAT THE TOTTAG DATA FROM FAMILY ONE
```{r}

setwd(
  "~/tottag_methods"
)

Day12C <- read.table("TotTag Files/Day 1/smoothedav2C.log") %>%
  mutate(
    V1 = (anytime(V1)) + 18000,
    V2 = str_remove(V2, "c0:98:00:00:e5:42:00:"),
    V2 = paste("2c_", V2)
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = format(as.POSIXct(
    strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
  ) , format = "%H:%M:%S"),
  Day = "1")

Day12D <- read.table("TotTag Files/Day 1/smoothedav2D.log") %>%
  mutate(
    V1 = (anytime(V1)) + 18000,
    V2 = str_remove(V2, "c0:98:00:00:e5:42:00:"),
    V2 = paste("2d_", V2)
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = format(as.POSIXct(
    strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
  ) , format = "%H:%M:%S"),
  Day = "1")

Day127 <- read.table("TotTag Files/Day 1/smoothedav27.log") %>%
  mutate(
    V1 = (anytime(V1)) + 18000,
    V2 = str_remove(V2, "c0:98:00:00:e5:42:00:"),
    V2 = paste("27_", V2)
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = format(as.POSIXct(
    strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
  ) , format = "%H:%M:%S"),
  Day = "1")

Day107 <- read.table("TotTag Files/Day 1/smoothedav07.log") %>%
  mutate(
    V1 = (anytime(V1)) + 18000,
    V2 = str_remove(V2, "c0:98:00:00:e5:42:00:"),
    V2 = paste("7_", V2)
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = format(as.POSIXct(
    strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
  ) , format = "%H:%M:%S"),
  Day = "1")

Day22C <- read.table("TotTag Files/Day 2/smoothedav2C.log") %>%
  mutate(
    V1 = (anytime(V1)) + 18000,
    V2 = str_remove(V2, "c0:98:00:00:e5:42:00:"),
    V2 = paste("2c_", V2)
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = format(as.POSIXct(
    strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
  ) , format = "%H:%M:%S"),
  Day = "2")

Day22D <- read.table("TotTag Files/Day 2/smoothedav2D.log") %>%
  mutate(
    V1 = (anytime(V1)) + 18000,
    V2 = str_remove(V2, "c0:98:00:00:e5:42:00:"),
    V2 = paste("2d_", V2)
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = format(as.POSIXct(
    strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
  ) , format = "%H:%M:%S"),
  Day = "2")

Day227 <- read.table("TotTag Files/Day 2/smoothedav27.log") %>%
  mutate(
    V1 = (anytime(V1)) + 18000,
    V2 = str_remove(V2, "c0:98:00:00:e5:42:00:"),
    V2 = paste("27_", V2)
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = format(as.POSIXct(
    strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
  ) , format = "%H:%M:%S"),
  Day = "2")

Day207 <- read.table("TotTag Files/Day 2/smoothedav07.log") %>%
  mutate(
    V1 = (anytime(V1)) + 18000,
    V2 = str_remove(V2, "c0:98:00:00:e5:42:00:"),
    V2 = paste("7_", V2)
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = format(as.POSIXct(
    strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
  ) , format = "%H:%M:%S"),
  Day = "2")


#BIND DATASETS ACCORDING TO DAY

F1ts1 <- seq.POSIXt(as.POSIXlt("2021-05-06 08:00:00"), as.POSIXlt("2021-05-06 19:59:59"), by="sec")
F1ts1 <- format.POSIXct(F1ts1,'%H:%M:%S')

df <- data.frame(Time=F1ts1) %>%
  mutate(DyadF = "momson") %>%
  bind_rows(data.frame(Time = F1ts1) %>%
              mutate(DyadF = "momdaughter")) %>%
  bind_rows(data.frame(Time = F1ts1) %>%
              mutate(DyadF = "momdad")) %>%
  bind_rows(data.frame(Time = F1ts1) %>%
              mutate(DyadF = "dadson")) %>%
  bind_rows(data.frame(Time = F1ts1) %>%
              mutate(DyadF = "daddaughter")) %>%
  bind_rows(data.frame(Time = F1ts1) %>%
              mutate(DyadF = "sondaughter"))

F1Day1 <-
  Day12C %>%
  bind_rows(Day12D, Day127, Day107) %>%
  mutate(DyadF = as.factor(Dyad)) %>%
  mutate(
    DyadF = fct_recode(
      DyadF,
      "momson" = "2c_ 2d",
      "momdaughter" = "2c_ 27",
      "momdad" = "2c_ 07",
      "dadson" = "7_ 2d",
      "daddaughter" = "7_ 27",
      "sondaughter" = "2d_ 27"
      )
  ) %>%
  right_join(df) %>%
  mutate(
    Time2 = as.POSIXct(Time, format = "%H:%M:%S")
  ) %>%
  filter(
    DyadF == "momson" | DyadF == "momdaughter" | DyadF == "momdad" |
      DyadF == "dadson" |
      DyadF == "daddaughter" | DyadF == "sondaughter"
  ) %>%
  mutate(Family = 1,
         Day = "1")

F1Day2 <-
  Day22C %>%
  bind_rows(Day22D, Day227, Day207) %>%
  mutate(DyadF = as.factor(Dyad)) %>%
  mutate(
    DyadF = fct_recode(
      DyadF,
      "momson" = "2c_ 2d",
      "momdaughter" = "2c_ 27",
      "momdad" = "2c_ 07",
      "dadson" = "7_ 2d",
      "daddaughter" = "7_ 27",
      "sondaughter" = "2d_ 27"
      )
    ) %>%
  right_join(df) %>%
    mutate(
      Time2 = as.POSIXct(Time, format = "%H:%M:%S")
      ) %>% 
  filter(
    DyadF == "momson" | DyadF == "momdaughter" | DyadF == "momdad" |
      DyadF == "dadson" |
      DyadF == "daddaughter" | DyadF == "sondaughter"
  ) %>%
  mutate(Family = 1,
         Day = "2")

F1BothDays <-
  F1Day1 %>%
  bind_rows(F1Day2)

```

# READ IN AND REFORMAT THE TOTTAG DATA FROM FAMILY TWO
```{r}

setwd(
  "~/tottag_methods"
)

BothDays4F <- read.table("TotTag Files/Day 1/smoothedav4F.log") %>%
  bind_rows(read.table("TotTag Files/Day 2/smoothedav4F.log")) %>%
  mutate(
    V2 = str_remove(V2, "c0:98:e5:42:00:"),
    V2 = paste("4F_", V2),
    Day = case_when(
      V1 >= 1616241600 & V1 <= 1616284800 ~ "1",
      V1 >= 1616328000 &
        V1 <= 1616371200 ~ "2"
    )
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = (anytime(Time)),
         Time = format(as.POSIXct(
           strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
         ) , format = "%H:%M:%S")) %>%
  filter(!is.na(Day)) %>%
  distinct() %>%
  arrange(Day, Time)

BothDays50 <- read.table("TotTag Files/Day 1/smoothedav50.log") %>%
  bind_rows(read.table("TotTag Files/Day 2/smoothedav50.log")) %>%
  mutate(
    V2 = str_remove(V2, "c0:98:e5:42:00:"),
    V2 = paste("50_", V2),
    Day = case_when(
      V1 >= 1616241600 & V1 <= 1616284800 ~ "1",
      V1 >= 1616328000 &
        V1 <= 1616371200 ~ "2"
    )
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = (anytime(Time)),
         Time = format(as.POSIXct(
           strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
         ) , format = "%H:%M:%S")) %>%
  filter(!is.na(Day)) %>%
  distinct() %>%
  arrange(Day, Time)

BothDays51 <- read.table("TotTag Files/Day 1/smoothedav51.log") %>%
  bind_rows(read.table("TotTag Files/Day 2/smoothedav51.log")) %>%
  mutate(
    V2 = str_remove(V2, "c0:98:e5:42:00:"),
    V2 = paste("51_", V2),
    Day = case_when(
      V1 >= 1616241600 & V1 <= 1616284800 ~ "1",
      V1 >= 1616328000 &
        V1 <= 1616371200 ~ "2"
    )
  ) %>%
  rename(Time = V1,
         Dyad = V2,
         Prox = V3) %>%
  mutate(Time = (anytime(Time)),
         Time = format(as.POSIXct(
           strptime(Time, "%Y-%m-%d %H:%M:%S", tz = "")
         ) , format = "%H:%M:%S")) %>%
  filter(!is.na(Day)) %>%
  distinct() %>%
  arrange(Day, Time)


#BIND DATASETS

F2ts1 <- seq.POSIXt(as.POSIXlt("2021-05-06 07:00:00"), as.POSIXlt("2021-05-06 18:59:59"), by="sec")
F2ts1 <- format.POSIXct(F2ts1,'%H:%M:%S')

df2 <- data.frame(Time=F2ts1) %>%
  mutate(DyadF = "momdaughter") %>%
  bind_rows(data.frame(Time = F2ts1) %>%
              mutate(DyadF = "momdad")) %>%
  bind_rows(data.frame(Time = F2ts1) %>%
              mutate(DyadF = "daddaughter"))

F2BothDays <-
  BothDays4F %>%
  bind_rows(BothDays51) %>%
  bind_rows(BothDays50) %>%
  mutate(DyadF = as.factor(Dyad)) %>%
  mutate(
    DyadF = fct_recode(
      DyadF,
      "momdaughter" = "4F_ 50",
      "momdad" = "4F_ 51",
      "daddaughter" = "51_ 50"
      )
    ) %>%
  filter(DyadF == "momdaughter" |
           DyadF == "momdad" | DyadF == "daddaughter") %>%
  distinct() %>%
  mutate(Family = 2) %>%
  arrange(Day, Time)

F2Day1 <-
  F2BothDays %>%
  filter(Day == 1) %>%
    right_join(df2) %>%
  mutate(
    Time2 = as.POSIXct(Time, format = "%H:%M:%S"),
    Day = "1"
    )

F2Day2 <-
  F2BothDays %>%
  filter(Day == 2)  %>%
    right_join(df2) %>%
  mutate(
    Time2 = as.POSIXct(Time, format = "%H:%M:%S"),
    Day = "2"
    )

F2BothDays <-
  F2Day1 %>%
  bind_rows(F2Day2)
```


# MARK, THEN REPLACE MISSING AND HIGH VALUES
```{r}

#CF = Censor (remove all observations above censored value) and Fill (replace missing with censored value)
#C = Censor only

F1BothDays <-
  F1BothDays %>%
  mutate(
    Miss = as.factor(if_else(!is.na(Prox), 0, 1)),
    ProxCF = if_else(Prox > 20, 20, Prox),
    ProxCF = replace_na(ProxCF, 20),
    ProxC = if_else(Prox > 20, NA_real_, Prox)
    )

F1Day1 <-
  F1Day1 %>%
  mutate(
    Miss = as.factor(if_else(!is.na(Prox), 0, 1)),
    ProxCF = if_else(Prox > 20, 20, Prox),
    ProxCF = replace_na(ProxCF, 20),
    ProxC = if_else(Prox > 20, NA_real_, Prox)
    )

F1Day2 <-
  F1Day2 %>%
  mutate(
    Miss = as.factor(if_else(!is.na(Prox), 0, 1)),
    ProxCF = if_else(Prox > 20, 20, Prox),
    ProxCF = replace_na(ProxCF, 20),
    ProxC = if_else(Prox > 20, NA_real_, Prox)
    )

F2BothDays <-
  F2BothDays %>%
  mutate(
    Miss = as.factor(if_else(!is.na(Prox), 0, 1)),
    ProxCF = if_else(Prox > 20, 20, Prox),
    ProxCF = replace_na(ProxCF, 20),
    ProxC = if_else(Prox > 20, NA_real_, Prox)
    )

F2Day1 <-
  F2Day1 %>%
  mutate(
    Miss = as.factor(if_else(!is.na(Prox), 0, 1)),
    ProxCF = if_else(Prox > 20, 20, Prox),
    ProxCF = replace_na(ProxCF, 20),
    ProxC = if_else(Prox > 20, NA_real_, Prox)
    )

F2Day2 <-
  F2Day2 %>%
  mutate(
    Miss = as.factor(if_else(!is.na(Prox), 0, 1)),
    ProxCF = if_else(Prox > 20, 20, Prox),
    ProxCF = replace_na(ProxCF, 20),
    ProxC = if_else(Prox > 20, NA_real_, Prox)
    )

```


# PLOT CONTINUOUS DATA FROM DAY ONE
```{r}
#FAMILY ONE Day 1

F1p1 <- F1Day1 %>%
  filter(DyadF == "momdaughter") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "orange") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

F1p2 <- F1Day1 %>%
  filter(DyadF == "momson") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "darkorange") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

F1p3 <- F1Day1 %>%
  filter(DyadF == "daddaughter") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "mediumseagreen") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

F1p4 <- F1Day1 %>%
  filter(DyadF == "dadson") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "seagreen") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

#FAMILY TWO Day 1
F2p1 <- F2Day1 %>%
  filter(DyadF == "momdaughter") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "darkorange3") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

F2p2 <- F2Day1 %>%
  filter(DyadF == "daddaughter") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "palegreen4") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

#knit plots together
Day1Plots <- (F1p1 + F1p2 + F2p1) /
  (F1p3 + F1p4 + F2p2) +
  plot_annotation(title = "Box 1",
                  tag_levels = 'A')
Day1Plots

ggsave(
  "Day1PlotsRevScaleC20.png",
  plot = Day1Plots,
  dpi = 300,
  height = 4.75,
  width = 7.5
)

```

#PLOT CONTINUOUS DATA FROM DAY TWO
```{r}
#FAMILY ONE Day 2
F1p5 <- F1Day2 %>%
  filter(DyadF == "momdaughter") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "orange") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

F1p6 <- F1Day2 %>%
  filter(DyadF == "momson") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "darkorange") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

F1p7 <- F1Day2 %>%
  filter(DyadF == "daddaughter") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "mediumseagreen") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

F1p8 <- F1Day2 %>%
  filter(DyadF == "dadson") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "seagreen") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

#FAMILY TWO Day 2
F2p3 <- F2Day2 %>%
  filter(DyadF == "momdaughter") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "darkorange3") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

F2p4 <- F2Day2 %>%
  filter(DyadF == "daddaughter") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "palegreen4") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

#knit plots together
Day2Plots <- (F1p5 + F1p6 + F2p3) /
  (F1p7 + F1p8 + F2p4)  +
  plot_annotation(title = "Box 2",
                  tag_levels = 'A')
Day2Plots

ggsave(
  "Day2PlotsRevScaleC20.png",
  plot = Day2Plots,
  dpi = 300,
  height = 4.75,
  width = 7.5
)

```

# DAILY STATS FOR FAMILY ONE
```{r}

F1BothDaysW <-
  F1BothDays %>%
  pivot_wider(
    id_cols = c(Day, Time),
    names_from = DyadF,
    values_from = c(Prox, ProxCF, ProxC),
    values_fill = NA
  ) %>%
  mutate(
    Day = as.numeric(Day),
    Time2 = as.POSIXct(Time, format = "%H:%M:%S"),
    MomSonTouch = if_else(Prox_momson <= 3, 1, 0),
    DadSonTouch = if_else(Prox_dadson <= 3, 1, 0),
    MomDaughterTouch = if_else(Prox_momdaughter <= 3, 1, 0),
    DadDaughterTouch = if_else(Prox_daddaughter <= 3, 1, 0),
    SOneTouch = if_else(MomSonTouch == 1 |
                          DadSonTouch == 1, 1, 0),
    SBothTouch = if_else(MomSonTouch == 1 &
                           DadSonTouch == 1, 1, 0),
    SNoTouch = if_else((MomSonTouch == 0 |
                          is.na(MomSonTouch)) &
                         (DadSonTouch == 0 |
                            is.na(DadSonTouch)), 1, 0),
    DOneTouch = if_else(MomDaughterTouch == 1 |
                          DadDaughterTouch == 1, 1, 0),
    DBothTouch = if_else(MomDaughterTouch == 1 &
                           DadDaughterTouch == 1, 1, 0),
    DNoTouch = if_else((MomDaughterTouch == 0 |
                          is.na(MomDaughterTouch)) &
                         (DadDaughterTouch == 0 |
                            is.na(DadDaughterTouch)),
                       1,
                       0
    )
  ) %>%
  mutate_at(
    vars(MomSonTouch:DNoTouch), replace_na, 0
  )


F1Stats <-
  F1BothDaysW %>%
  group_by(Day) %>%
  summarize(
    MomSonMean = mean(Prox_momson, na.rm = TRUE),
    DadSonMean = mean(Prox_dadson, na.rm = TRUE),
    MomDaughterMean = mean(Prox_momdaughter, na.rm = TRUE),
    DadDaughterMean = mean(Prox_daddaughter, na.rm = TRUE),
    MomSonMeanC = mean(ProxC_momson, na.rm = TRUE),
    DadSonMeanC = mean(ProxC_dadson, na.rm = TRUE),
    MomDaughterMeanC = mean(ProxC_momdaughter, na.rm = TRUE),
    DadDaughterMeanC = mean(ProxC_daddaughter, na.rm = TRUE),
    MomSonCount = length(na.omit(Prox_momson)),
    DadSonCount = length(na.omit(Prox_dadson)),
    MomDaughterCount = length(na.omit(Prox_momdaughter)),
    DadDaughterCount = length(na.omit(Prox_daddaughter)),
    MomSonCountC = length(na.omit(ProxC_momson)),
    DadSonCountC = length(na.omit(ProxC_dadson)),
    MomDaughterCountC = length(na.omit(ProxC_momdaughter)),
    DadDaughterCountC = length(na.omit(ProxC_daddaughter)),
    MomSonTouch = sum(MomSonTouch),
    DadSonTouch = sum(DadSonTouch),
    MomDaughterTouch = sum(MomDaughterTouch),
    DadDaughterTouch = sum(DadDaughterTouch),
    SOneTouch = sum(SOneTouch),
    SBothTouch = sum(SBothTouch),
    SNoTouch = sum(SNoTouch),
    DOneTouch = sum(DOneTouch),
    DBothTouch = sum(DBothTouch),
    DNoTouch = sum(DNoTouch)
  ) %>%
  mutate(
    MomSonTimeTouch = MomSonTouch / 60,
    DadSonTimeTouch = DadSonTouch / 60,
    MomDaughterTimeTouch = MomDaughterTouch / 60,
    DadDaughterTimeTouch = DadDaughterTouch / 60,
    MomSonTouchP = MomSonTouch / 43200,
    DadSonTouchP = DadSonTouch / 43200,
    MomDaughterTouchP = MomDaughterTouch / 43200,
    DadDaughterTouchP = DadDaughterTouch / 43200,
    MomSonTouchPc = MomSonTouch / MomSonCount,
    DadSonTouchPc = DadSonTouch / DadSonCount,
    MomDaughterTouchPc = MomDaughterTouch / MomDaughterCount,
    DadDaughterTouchPc = DadDaughterTouch / DadDaughterCount,
    MomSonTouchPcC = MomSonTouch / MomSonCountC,
    DadSonTouchPcC = DadSonTouch / DadSonCountC,
    MomDaughterTouchPcC = MomDaughterTouch / MomDaughterCountC,
    DadDaughterTouchPcC = DadDaughterTouch / DadDaughterCountC,
    SOneTouchTime = SOneTouch / 60,
    SBothTouchTime = SBothTouch / 60,
    SNoTouchTime = SNoTouch / 60,
    SOneTouchP = SOneTouch / 43200,
    SBothTouchP = SBothTouch / 43200,
    SNoTouchP = SNoTouch / 43200,
    DOneTouchTime = DOneTouch / 60,
    DBothTouchTime = DBothTouch / 60,
    DNoTouchTime = DNoTouch / 60,
    DOneTouchP = DOneTouch / 43200,
    DBothTouchP = DBothTouch / 43200,
    DNoTouchP = DNoTouch / 43200
  )

```

#DAILY STATS FOR FAMILY TWO
```{r}

F2BothDaysW <-
  F2BothDays %>%
  pivot_wider(
    id_cols = c(Day, Time),
    names_from = DyadF,
    values_from = c(Prox,ProxCF, ProxC),
    values_fill = NA
  ) %>%
  mutate(
    Day = as.numeric(Day),
    Time2 = as.POSIXct(Time, format = "%H:%M:%S"),
    MomDaughterTouch = if_else(Prox_momdaughter <= 3, 1, 0),
    DadDaughterTouch = if_else(Prox_daddaughter <= 3, 1, 0),
    DOneTouch = if_else(MomDaughterTouch == 1 |
                          DadDaughterTouch == 1, 1, 0),
    DBothTouch = if_else(MomDaughterTouch == 1 &
                           DadDaughterTouch == 1, 1, 0),
    DNoTouch = if_else((MomDaughterTouch == 0 |
                          is.na(MomDaughterTouch)) &
                         (DadDaughterTouch == 0 |
                            is.na(DadDaughterTouch)),
                       1,
                       0
    )
  ) %>%
  mutate_at(vars(MomDaughterTouch:DNoTouch), replace_na, 0)

F2Stats <-
  F2BothDaysW %>%
  group_by(Day) %>%
  summarize(
    MomDaughterMean = mean(Prox_momdaughter, na.rm = TRUE),
    DadDaughterMean = mean(Prox_daddaughter, na.rm = TRUE),
    MomDaughterMeanC = mean(ProxC_momdaughter, na.rm = TRUE),
    DadDaughterMeanC = mean(ProxC_daddaughter, na.rm = TRUE),
    MomDaughterCount = length(na.omit(Prox_momdaughter)),
    DadDaughterCount = length(na.omit(Prox_daddaughter)),
    MomDaughterCountC = length(na.omit(ProxC_momdaughter)),
    DadDaughterCountC = length(na.omit(ProxC_daddaughter)),
    MomDaughterTouch = sum(MomDaughterTouch),
    DadDaughterTouch = sum(DadDaughterTouch),
    DOneTouch = sum(DOneTouch),
    DBothTouch = sum(DBothTouch),
    DNoTouch = sum(DNoTouch)
  ) %>%
  mutate(
    MomDaughterTimeTouch = MomDaughterTouch / 60,
    DadDaughterTimeTouch = DadDaughterTouch / 60,
    MomDaughterTouchP = MomDaughterTouch / 43200,
    DadDaughterTouchP = DadDaughterTouch / 43200,
    MomDaughterTouchPc = MomDaughterTouch / MomDaughterCount,
    DadDaughterTouchPc = DadDaughterTouch / DadDaughterCount,
    MomDaughterTouchPcC = MomDaughterTouch / MomDaughterCountC,
    DadDaughterTouchPcC = DadDaughterTouch / DadDaughterCountC,
    DOneTouchTime = DOneTouch / 60,
    DBothTouchTime = DBothTouch / 60,
    DNoTouchTime = DNoTouch / 60,
    DOneTouchP = DOneTouch / 43200,
    DBothTouchP = DBothTouch / 43200,
    DNoTouchP = DNoTouch / 43200
  )

```


# Filtering for Check with Caregiver Reports
```{r}

#adjust filter day/times according to each report

EMA <- filter(F2Day2,
              (hour(Time2) == 19 & minute(Time2) == 39))

EMA %>%
  group_by(DyadF) %>%
  summarise_at(
    vars(Prox),
    funs(min, max, mean,sd))

```

# LENA DATA

# Import and reformat FAMILY ONE LENA data

```{r}

setwd("~/Dropbox/Research/Vanderbilt/Ecology of Early Life/Methods Manuscript/Data/Family One")

F1SonDay1Lena <-
  read_csv("lena/F1S_Day 1.csv") %>%
  select(Clock_Time_UTC,
         AWC,
         Turn_Count,
         Child_Voc_Count,
         FAN_Word_Count,
         MAN_Word_Count,
         SIL) %>%
  mutate(Clock_Time_UTC = as.POSIXct(Clock_Time_UTC,format="%m/%d/%Y %H:%M:%S"),
         Time = Clock_Time_UTC-18000) %>%
  filter(Time >= as.POSIXct("2020-06-06 08:00:00"),
         Time < as.POSIXct("2020-06-06 20:00:00")) %>%
  mutate(Time = format(as.POSIXct(strptime(Time,"%Y-%m-%d %H:%M:%S",tz="")) ,format = "%H:%M:%S"),
         AWC_son = AWC,
         CT_son = Turn_Count,
         CV_son = Child_Voc_Count,
         FAWC_son = FAN_Word_Count,
         MAWC_son = MAN_Word_Count,
         SIL_son = SIL) %>%
  select(-AWC,
         -Turn_Count,
         -Child_Voc_Count,
         -FAN_Word_Count,
         -MAN_Word_Count,
         -SIL,
         -Clock_Time_UTC)

F1DaughterDay1Lena <-
  read_csv("lena/F1D_Day 1.csv") %>% 
  select(Clock_Time_UTC,
         AWC,
         Turn_Count,
         Child_Voc_Count,
         FAN_Word_Count,
         MAN_Word_Count,
         SIL) %>%
  mutate(Clock_Time_UTC = as.POSIXct(Clock_Time_UTC,format="%m/%d/%Y %H:%M:%S"),
         Time = Clock_Time_UTC-18000) %>%
  filter(Time >= as.POSIXct("2020-06-06 08:00:00"),
         Time < as.POSIXct("2020-06-06 20:00:00")) %>%
  mutate(Time = format(as.POSIXct(strptime(Time,"%Y-%m-%d %H:%M:%S",tz="")) ,format = "%H:%M:%S"),
         AWC_daughter = AWC,
         CT_daughter = Turn_Count,
         CV_daughter = Child_Voc_Count,
         FAWC_daughter = FAN_Word_Count,
         MAWC_daughter = MAN_Word_Count,
         SIL_daughter = SIL) %>%
  select(-AWC,
         -Turn_Count,
         -Child_Voc_Count,
         -FAN_Word_Count,
         -MAN_Word_Count,
         -SIL,
         -Clock_Time_UTC)

F1SonDay2Lena <-
  read_csv("lena/F1S_Day 2.csv") %>%
  select(Clock_Time_UTC,
         AWC,
         Turn_Count,
         Child_Voc_Count,
         FAN_Word_Count,
         MAN_Word_Count,
         SIL) %>%
  mutate(Clock_Time_UTC = as.POSIXct(Clock_Time_UTC,format="%m/%d/%Y %H:%M:%S"),
         Time = Clock_Time_UTC-18000) %>%
  filter(Time >= as.POSIXct("2020-06-07 08:00:00"),
         Time < as.POSIXct("2020-06-07 20:00:00")) %>%
  mutate(Time = format(as.POSIXct(strptime(Time,"%Y-%m-%d %H:%M:%S",tz="")) ,format = "%H:%M:%S"),
         AWC_son = AWC,
         CT_son = Turn_Count,
         CV_son = Child_Voc_Count,
         FAWC_son = FAN_Word_Count,
         MAWC_son = MAN_Word_Count,
         SIL_son = SIL) %>%
  select(-AWC,
         -Turn_Count,
         -Child_Voc_Count,
         -FAN_Word_Count,
         -MAN_Word_Count,
         -SIL,
         -Clock_Time_UTC)

F1DaughterDay2Lena <-
  read_csv("lena/F1D_Day 2.csv") %>% 
  select(Clock_Time_UTC,
         AWC,
         Turn_Count,
         Child_Voc_Count,
         FAN_Word_Count,
         MAN_Word_Count,
         SIL) %>%
  mutate(Clock_Time_UTC = as.POSIXct(Clock_Time_UTC,format="%m/%d/%Y %H:%M:%S"),
         Time = Clock_Time_UTC-18000) %>% 
  filter(Time >= as.POSIXct("2020-06-07 08:00:00"),
         Time < as.POSIXct("2020-06-07 20:00:00")) %>%
  mutate(Time = format(as.POSIXct(strptime(Time,"%Y-%m-%d %H:%M:%S",tz="")) ,format = "%H:%M:%S"),
         AWC_daughter = AWC,
         CT_daughter = Turn_Count,
         CV_daughter = Child_Voc_Count,
         FAWC_daughter = FAN_Word_Count,
         MAWC_daughter = MAN_Word_Count,
         SIL_daughter = SIL) %>%
  select(-AWC,
         -Turn_Count,
         -Child_Voc_Count,
         -FAN_Word_Count,
         -MAN_Word_Count,
         -SIL,
         -Clock_Time_UTC)

```

# Import and reformat FAMILY TWO LENA data

```{r}

setwd("~/Dropbox/Research/Vanderbilt/Ecology of Early Life/Methods Manuscript/Data/Family Two")

F2DaughterDay1Lena <-
  read_csv("lena/F2D_Day 1.csv") %>% 
  select(Clock_Time_TZAdj,
         AWC,
         Turn_Count,
         Child_Voc_Count,
         FAN_Word_Count,
         MAN_Word_Count,
         SIL) %>%
  mutate(Clock_Time_TZAdj = as.POSIXct(Clock_Time_TZAdj,format="%m/%d/%Y %H:%M:%S"),
         Time = Clock_Time_TZAdj-21600) %>% 
  filter(Time >= as.POSIXct("2021-03-20 07:00:00"),
         Time < as.POSIXct("2021-03-20 19:00:00")) %>%
  mutate(Time = format(as.POSIXct(strptime(Time,"%Y-%m-%d %H:%M:%S",tz="")) ,format = "%H:%M:%S"),
         AWC_daughter = AWC,
         CT_daughter = Turn_Count,
         CV_daughter = Child_Voc_Count,
         FAWC_daughter = FAN_Word_Count,
         MAWC_daughter = MAN_Word_Count,
         SIL_daughter = SIL) %>%
  select(-AWC,
         -Turn_Count,
         -Child_Voc_Count,
         -FAN_Word_Count,
         -MAN_Word_Count,
         -SIL,
         -Clock_Time_TZAdj)

F2DaughterDay2Lena <-
  read_csv("lena/F2D_Day 2.csv") %>% 
  select(Clock_Time_TZAdj,
         AWC,
         Turn_Count,
         Child_Voc_Count,
         FAN_Word_Count,
         MAN_Word_Count,
         SIL) %>%
  mutate(Clock_Time_TZAdj = as.POSIXct(Clock_Time_TZAdj,format="%m/%d/%Y %H:%M:%S"),
         Time = Clock_Time_TZAdj-21600) %>% 
  filter(Time >= as.POSIXct("2021-03-21 07:00:00"),
         Time < as.POSIXct("2021-03-21 19:00:00")) %>%
  mutate(Time = floor_date(Time, "minute")
         ) %>%
  mutate(Time = format(as.POSIXct(strptime(Time,"%Y-%m-%d %H:%M:%S",tz="")) ,format = "%H:%M:%S"),
         AWC_daughter = AWC,
         CT_daughter = Turn_Count,
         CV_daughter = Child_Voc_Count,
         FAWC_daughter = FAN_Word_Count,
         MAWC_daughter = MAN_Word_Count,
         SIL_daughter = SIL) %>%
  select(-AWC,
         -Turn_Count,
         -Child_Voc_Count,
         -FAN_Word_Count,
         -MAN_Word_Count,
         -SIL,
         -Clock_Time_TZAdj)

```



# Reformat FAMILY ONE TotTag data and combine with LENA
```{r}

#Aggregrate into 5minute chunks
#Calculate total time and proportion of time in touching distance

F1Day1Wagg <- F1BothDaysW %>%
  filter(Day == 1) %>%
  group_by(Day,
           Time2 = cut(Time2, breaks = "5 min")) %>%
  summarize(
    momdad_O = mean(Prox_momdad, na.rm = TRUE),
    momdaughter_O = mean(Prox_momdaughter, na.rm = TRUE),
    momson_O = mean(Prox_momson, na.rm = TRUE),
    daddaughter_O = mean(Prox_daddaughter, na.rm = TRUE),
    dadson_O = mean(Prox_dadson, na.rm = TRUE),
    sondaughter_O = mean(Prox_sondaughter, na.rm = TRUE),
    momdad_C = mean(ProxC_momdad, na.rm = TRUE),
    momdaughter_C = mean(ProxC_momdaughter, na.rm = TRUE),
    momson_C = mean(ProxC_momson, na.rm = TRUE),
    daddaughter_C = mean(ProxC_daddaughter, na.rm = TRUE),
    dadson_C = mean(ProxC_dadson, na.rm = TRUE),
    sondaughter_C = mean(ProxC_sondaughter, na.rm = TRUE),
    momdad_CF = mean(ProxCF_momdad, na.rm = TRUE),
    momdaughter_CF = mean(ProxCF_momdaughter, na.rm = TRUE),
    momson_CF = mean(ProxCF_momson, na.rm = TRUE),
    daddaughter_CF = mean(ProxCF_daddaughter, na.rm = TRUE),
    dadson_CF = mean(ProxCF_dadson, na.rm = TRUE),
    sondaughter_CF = mean(ProxCF_sondaughter, na.rm = TRUE),
    MomSonTouch = sum(MomSonTouch),
    DadSonTouch = sum(DadSonTouch),
    MomDaughterTouch = sum(MomDaughterTouch),
    DadDaughterTouch = sum(DadDaughterTouch),
    SOneTouch = sum(SOneTouch),
    SBothTouch = sum(SBothTouch),
    SNoTouch = sum(SNoTouch),
    DOneTouch = sum(DOneTouch),
    DBothTouch = sum(DBothTouch),
    DNoTouch = sum(DNoTouch)
  ) %>%
  mutate(
    MomSonTouchP = MomSonTouch / 300,
    DadSonTouchP = DadSonTouch / 300,
    MomDaughterTouchP = MomDaughterTouch / 300,
    DadDaughterTouchP = DadDaughterTouch / 300,
    SOneTouchP = SOneTouch / 300,
    SBothTouchP = SBothTouch / 300,
    SNoTouchP = SNoTouch / 300,
    DOneTouchP = DOneTouch / 300,
    DBothTouchP = DBothTouch / 300,
    DNoTouchP = DNoTouch / 300,
    Time = format(as.POSIXct(
      strptime(Time2, "%Y-%m-%d %H:%M:%S", tz = "")
    ) , format = "%H:%M:%S")
  )

F1Day2Wagg <- F1BothDaysW %>%
  filter(Day == 2) %>%
  group_by(Day,
           Time2 = cut(Time2, breaks = "5 min")) %>%
  summarize(
    momdad_O = mean(Prox_momdad, na.rm = TRUE),
    momdaughter_O = mean(Prox_momdaughter, na.rm = TRUE),
    momson_O = mean(Prox_momson, na.rm = TRUE),
    daddaughter_O = mean(Prox_daddaughter, na.rm = TRUE),
    dadson_O = mean(Prox_dadson, na.rm = TRUE),
    sondaughter_O = mean(Prox_sondaughter, na.rm = TRUE),
    momdad_C = mean(ProxC_momdad, na.rm = TRUE),
    momdaughter_C = mean(ProxC_momdaughter, na.rm = TRUE),
    momson_C = mean(ProxC_momson, na.rm = TRUE),
    daddaughter_C = mean(ProxC_daddaughter, na.rm = TRUE),
    dadson_C = mean(ProxC_dadson, na.rm = TRUE),
    sondaughter_C = mean(ProxC_sondaughter, na.rm = TRUE),
    momdad_CF = mean(ProxCF_momdad, na.rm = TRUE),
    momdaughter_CF = mean(ProxCF_momdaughter, na.rm = TRUE),
    momson_CF = mean(ProxCF_momson, na.rm = TRUE),
    daddaughter_CF = mean(ProxCF_daddaughter, na.rm = TRUE),
    dadson_CF = mean(ProxCF_dadson, na.rm = TRUE),
    sondaughter_CF = mean(ProxCF_sondaughter, na.rm = TRUE),
    MomSonTouch = sum(MomSonTouch),
    DadSonTouch = sum(DadSonTouch),
    MomDaughterTouch = sum(MomDaughterTouch),
    DadDaughterTouch = sum(DadDaughterTouch),
    SOneTouch = sum(SOneTouch),
    SBothTouch = sum(SBothTouch),
    SNoTouch = sum(SNoTouch),
    DOneTouch = sum(DOneTouch),
    DBothTouch = sum(DBothTouch),
    DNoTouch = sum(DNoTouch)
  ) %>%
  mutate(
    MomSonTouchP = MomSonTouch / 300,
    DadSonTouchP = DadSonTouch / 300,
    MomDaughterTouchP = MomDaughterTouch / 300,
    DadDaughterTouchP = DadDaughterTouch / 300,
    SOneTouchP = SOneTouch / 300,
    SBothTouchP = SBothTouch / 300,
    SNoTouchP = SNoTouch / 300,
    DOneTouchP = DOneTouch / 300,
    DBothTouchP = DBothTouch / 300,
    DNoTouchP = DNoTouch / 300,
    Time = format(as.POSIXct(
      strptime(Time2, "%Y-%m-%d %H:%M:%S", tz = "")
    ) , format = "%H:%M:%S")
  )

F1Day1Lena <- F1Day1Wagg %>%
  full_join(F1SonDay1Lena, by = "Time") %>%
  full_join(F1DaughterDay1Lena, by = "Time")


F1Day2Lena <- F1Day2Wagg %>%
  full_join(F1SonDay2Lena, by = "Time") %>%
  full_join(F1DaughterDay2Lena, by = "Time")

F1BothDaysLena <- F1Day1Lena %>%
  bind_rows(F1Day2Lena) %>%
  replace_na(
    list(
      MomSonTouchP = 0,
      DadSonTouchP = 0,
      MomDaughterTouchP = 0,
      DadDaughterTouchP = 0,
      MomSonTouchPC = 0,
      DadSonTouchPC = 0,
      MomDaughterTouchPC = 0,
      DadDaughterTouchPC = 0,
      SOneTouchP = 0,
      DOneTouchP = 0,
      SBothTouchP = 0,
      DBothTouchP = 0,
      SNoTouchP = 0,
      DNoTouchP = 0,
      SOneTouchPC = 0,
      DOneTouchPC = 0,
      SBothTouchPC = 0,
      DBothTouchPC = 0,
      SNoTouchPC = 0,
      DNoTouchPC = 0
    )
  )

```


# Reformat FAMILY TWO TotTag data and combine with LENA
```{r}

#Aggregrate into 5minute chunks
#Calculate total time and proportion of time in touching distance

F2Day1Wagg <- F2BothDaysW %>%
  filter(Day == 1) %>%
  mutate(Time2 = as.POSIXct(Time2,"%Y-%m-%d %H:%M:%S",tz=""),
         Time2_5min = floor_date(Time2, "5 mins")) %>%
  group_by(Day,
           Time2_5min) %>%
  summarize(
    momdad_O = mean(Prox_momdad, na.rm = TRUE),
    momdaughter_O = mean(Prox_momdaughter, na.rm = TRUE),
    daddaughter_O = mean(Prox_daddaughter, na.rm = TRUE),
    momdad_C = mean(ProxC_momdad, na.rm = TRUE),
    momdaughter_C = mean(ProxC_momdaughter, na.rm = TRUE),
    daddaughter_C = mean(ProxC_daddaughter, na.rm = TRUE),
    momdad_CF = mean(ProxCF_momdad, na.rm = TRUE),
    momdaughter_CF = mean(ProxCF_momdaughter, na.rm = TRUE),
    daddaughter_CF = mean(ProxCF_daddaughter, na.rm = TRUE),
    MomDaughterTouch = sum(MomDaughterTouch),
    DadDaughterTouch = sum(DadDaughterTouch),
    DOneTouch = sum(DOneTouch),
    DBothTouch = sum(DBothTouch),
    DNoTouch = sum(DNoTouch)
  ) %>%
  mutate(
    MomDaughterTouchP = MomDaughterTouch / 300,
    DadDaughterTouchP = DadDaughterTouch / 300,
    DOneTouchP = DOneTouch / 300,
    DBothTouchP = DBothTouch / 300,
    DNoTouchP = DNoTouch / 300,
    Time = format(as.POSIXct(
      strptime(Time2_5min, "%Y-%m-%d %H:%M:%S", tz = "")
    ) , format = "%H:%M:%S")
  )


F2Day2Wagg <- F2BothDaysW %>%
  filter(Day == 2) %>%
  mutate(Time2 = as.POSIXct(Time2,"%Y-%m-%d %H:%M:%S",tz=""),
         Time2_5min = floor_date(Time2, "5 mins")) %>%
  group_by(Day,
           Time2_5min) %>%
  summarize(
    momdad_O = mean(Prox_momdad, na.rm = TRUE),
    momdaughter_O = mean(Prox_momdaughter, na.rm = TRUE),
    daddaughter_O = mean(Prox_daddaughter, na.rm = TRUE),
    momdad_C = mean(ProxC_momdad, na.rm = TRUE),
    momdaughter_C = mean(ProxC_momdaughter, na.rm = TRUE),
    daddaughter_C = mean(ProxC_daddaughter, na.rm = TRUE),
    momdad_CF = mean(ProxCF_momdad, na.rm = TRUE),
    momdaughter_CF = mean(ProxCF_momdaughter, na.rm = TRUE),
    daddaughter_CF = mean(ProxCF_daddaughter, na.rm = TRUE),
    MomDaughterTouch = sum(MomDaughterTouch),
    DadDaughterTouch = sum(DadDaughterTouch),
    DOneTouch = sum(DOneTouch),
    DBothTouch = sum(DBothTouch),
    DNoTouch = sum(DNoTouch)
  ) %>%
  mutate(
    MomDaughterTouchP = MomDaughterTouch / 300,
    DadDaughterTouchP = DadDaughterTouch / 300,
    DOneTouchP = DOneTouch / 300,
    DBothTouchP = DBothTouch / 300,
    DNoTouchP = DNoTouch / 300,
    Time = format(as.POSIXct(
      strptime(Time2_5min, "%Y-%m-%d %H:%M:%S", tz = "")
    ) , format = "%H:%M:%S")
  )

F2Day1Lena <- F2Day1Wagg %>%
  full_join(F2DaughterDay1Lena,by="Time") 


F2Day2Lena <- F2Day2Wagg %>%
  full_join(F2DaughterDay2Lena,by="Time")

F2BothDaysLena <- F2Day1Lena %>%
  bind_rows(F2Day2Lena) %>%
  replace_na(list(MomDaughterTouchP = 0,
                  DadDaughterTouchP = 0,
                  MomDaughterTouchPC = 0,
                  DadDaughterTouchPC = 0,
                  DOneTouchP = 0,
                  DBothTouchP = 0,
                  DNoTouchP = 0,
                  DOneTouchPC = 0,
                  DBothTouchPC = 0,
                  DNoTouchPC = 0)) %>%
  rename(Time2 = Time2_5min)

```


# Subset and reformat data for AWC analysis
``` {r}

AllLena <- F1BothDaysLena %>%
  mutate(Family = 1) %>%
  select(-Time2) %>%
  bind_rows(F2BothDaysLena %>%
              mutate(Family = 2) %>%
              select(-Time2))

AllLenaLong <- AllLena %>%
  select(
    Day,
    Time,
    Family,
    momson_O,
    dadson_O,
    momdaughter_O,
    daddaughter_O,
    momson_C,
    dadson_C,
    momdaughter_C,
    daddaughter_C,
    momson_CF,
    dadson_CF,
    momdaughter_CF,
    daddaughter_CF,
    MomSonTouchP,
    DadSonTouchP,
    MomDaughterTouchP,
    DadDaughterTouchP,
    FAWC_son,
    FAWC_daughter,
    MAWC_son,
    MAWC_daughter,
    CV_son,
    CV_daughter
  ) %>%
  pivot_longer(
    cols = c("momson_O", "dadson_O", "momdaughter_O", "daddaughter_O", 
             "momson_C", "dadson_C", "momdaughter_C", "daddaughter_C",
             "momson_CF", "dadson_CF", "momdaughter_CF", "daddaughter_CF"),
    names_to = c("Dyad", "ProxType"),
    names_ptypes = list(Dyad = factor()),
    names_sep = "_",
    values_to = "Prox",
    values_ptypes = list(Prox = numeric())
  ) %>%
  mutate(
    FAWC = case_when(Dyad == "momson" ~ FAWC_son,
                     Dyad == "momdaughter" ~ FAWC_daughter),
    MAWC = case_when(Dyad == "dadson" ~ MAWC_son,
                     Dyad == "daddaughter" ~ MAWC_daughter),
    CVC = case_when(
      Dyad == "momson" ~ CV_son,
      Dyad == "momdaughter" ~ CV_daughter,
      Dyad == "dadson" ~ CV_son,
      Dyad == "daddaughter" ~ CV_daughter
    ),
    ParentTouchP = case_when(
      Dyad == "momson" ~ MomSonTouchP,
      Dyad == "momdaughter" ~ MomDaughterTouchP,
      Dyad == "dadson" ~ DadSonTouchP,
      Dyad == "daddaughter" ~ DadDaughterTouchP
    )
  ) %>%
  select(Day,
         Time,
         Family,
         Dyad,
         ProxType,
         Prox,
         FAWC,
         MAWC,
         CVC,
         ParentTouchP)

momlena <- AllLenaLong %>%
  filter((Family == 1 & Dyad == "momson") | (Family == 1 & Dyad == "momdaughter") | (Family == 2 & Dyad == "momdaughter")) %>%
  mutate(Child = case_when(Family == 1 & Dyad == "momdaughter" ~ "Family 1: Daughter",
                           Family == 1 & Dyad == "momson" ~ "Family 1: Son",
                           Family == 2 & Dyad == "momdaughter" ~ "Family 2: Daughter"),
         Child = as.factor(Child)) %>%
  filter(Child == "Family 1: Daughter" | Child == "Family 1: Son" | Child == "Family 2: Daughter")

dadlena <- AllLenaLong %>%
  filter((Family == 1 & Dyad == "dadson") | (Family == 1 & Dyad == "daddaughter") | (Family == 2 & Dyad == "daddaughter")) %>%
  mutate(Child = case_when(Family == 1 & Dyad == "daddaughter" ~ "Family 1: Daughter",
                           Family == 1 & Dyad == "dadson" ~ "Family 1: Son",
                           Family == 2 & Dyad == "daddaughter" ~ "Family 2: Daughter"),
         Child = as.factor(Child)) %>%
  filter(Child == "Family 1: Daughter" | Child == "Family 1: Son" | Child == "Family 2: Daughter")
  

```

       
# Subset and reformat data for CT analysis
```{r}

Son <- AllLena %>%
  mutate(OneTouchP = SOneTouchP, 
         BothTouchP = SBothTouchP,
         NoTouchP = SNoTouchP,
         AWC = AWC_son, 
         CT = CT_son, 
         CV = CV_son, 
         SIL = SIL_son,
         Kiddo = "Son") %>%
  select(Day, Time, Family, Kiddo, OneTouchP, BothTouchP,
         NoTouchP, AWC, CT, CV, SIL) 
  
Daughter <- AllLena %>%
  mutate(OneTouchP = DOneTouchP, 
         BothTouchP = DBothTouchP, 
         NoTouchP = DNoTouchP, 
         AWC = AWC_daughter, 
         CT = CT_daughter, 
         CV = CV_daughter, 
         SIL = SIL_daughter,
         Kiddo = "Daughter") %>%
  select(Day, Time, Family, Kiddo, OneTouchP, BothTouchP, 
       NoTouchP, AWC, CT, CV, SIL) 

SonDaughter <- Son %>%
  bind_rows(Daughter) %>%
  mutate(Child = case_when(Family == 1 & Kiddo == "Daughter" ~ "Family 1: Daughter",
                           Family == 1 & Kiddo == "Son" ~ "Family 1: Son",
                           Family == 2 & Kiddo == "Daughter" ~ "Family 2: Daughter"),
         Child = as.factor(Child)) %>%
  filter(Child == "Family 1: Daughter" | Child == "Family 1: Son" | Child == "Family 2: Daughter")

```

#ANALYSES WITH Censored/Filled (NA & >20) PROXIMITY DATA

# Subset data
``` {r}

momlenaCF <- momlena %>%
  filter(
    ProxType == "CF"
  )

dadlenaCF <- dadlena %>%
  filter(
    ProxType == "CF"
  )

```

# Correlations and Scatterplots
``` {r}


cor.test(momlenaCF$Prox,momlenaCF$FAWC, method = "spearman", exact = FALSE)
SpearmanRho(momlenaCF$Prox,momlenaCF$FAWC, conf.level = 0.95)
p9CF <- momlenaCF %>%
  ggplot(aes(x=Prox, y=FAWC, color = Child)) + 
  geom_point(shape = 21, size=2, position = "jitter", alpha = .5) +
  geom_smooth(method=lm, color="black", se=F) +
  ylim(NA,800) +
  labs(x="Proximity to Mother (ft)", y="Female Adult Word Count") +
  theme(panel.background = element_rect(fill = "white"), 
        axis.title = element_text(family = "Arial", size=12, color = "black"), 
        axis.line = element_line(size = .5, colour = "black"), 
        axis.text = element_text(family = "Arial", size=10, color = "black"),
        aspect.ratio = 1)

cor.test(momlenaCF$ParentTouchP,momlenaCF$FAWC, method = "spearman", exact = FALSE)
SpearmanRho(momlenaCF$ParentTouchP,momlenaCF$FAWC, conf.level = 0.95)
p10CF <- momlenaCF %>%
  ggplot(aes(x=ParentTouchP, y=FAWC, color = Child)) + 
  geom_point(shape = 21, size=2, position = "jitter", alpha = .5)+
  geom_smooth(method=lm, color="black", se=F) +
  ylim(NA,800) +
  labs(x="Proportion of 5-min Segment within 
       Touching Distance of Mother", y="Female Adult Word Count") +
  theme(panel.background = element_rect(fill = "white"), 
        axis.title = element_text(family = "Arial", size=12, color = "black"), 
        axis.line = element_line(size = .5, colour = "black"), 
        axis.text = element_text(family = "Arial", size=10, color = "black"),
        aspect.ratio = 1)

FAWCproxCF <- p9CF+p10CF + plot_layout(guides = 'collect')
FAWCproxCF
ggsave("FAWCproxCF.png",
       plot = FAWCproxCF,
       dpi = 300)

cor.test(dadlenaCF$Prox,dadlenaCF$MAWC, method = "spearman", exact = FALSE)
SpearmanRho(dadlenaCF$Prox,dadlenaCF$MAWC, conf.level = 0.95)
p11CF <- dadlenaCF %>%
  ggplot(aes(x=Prox, y=MAWC, color = Child)) + 
  geom_point(shape = 21, size=2, position = "jitter", alpha = .5)+
  geom_smooth(method=lm, color="black", se=F) +
  labs(x="Proximity to Father (ft)", y="Male Adult Word Count") +
  theme(panel.background = element_rect(fill = "white"), 
        axis.title = element_text(family = "Arial", size=12, color = "black"), 
        axis.line = element_line(size = .5, colour = "black"), 
        axis.text = element_text(family = "Arial", size=10, color = "black"),
        aspect.ratio = 1)

cor.test(dadlenaCF$ParentTouchP,dadlenaCF$MAWC, method = "spearman", exact = FALSE)
SpearmanRho(dadlenaCF$ParentTouchP,dadlenaCF$MAWC, conf.level = 0.95)
p12CF <- dadlenaCF %>%
  ggplot(aes(x=ParentTouchP, y=MAWC, color = Child)) + 
  geom_point(shape = 21, size=2, position = "jitter", alpha = .5)+
  geom_smooth(method=lm, color="black", se=F) +
  labs(x="Proportion of 5-min Segment within
       Touching Distance of Father", y="Male Adult Word Count") +
  theme(panel.background = element_rect(fill = "white"), 
        axis.title = element_text(family = "Arial", size=12, color = "black"), 
        axis.line = element_line(size = .5, colour = "black"), 
        axis.text = element_text(family = "Arial", size=10, color = "black"),
        aspect.ratio = 1)

MAWCproxCF <- p11CF+p12CF + plot_layout(guides = 'collect')
MAWCproxCF
ggsave("MAWCproxCF.png",
       plot = MAWCproxCF,
       dpi = 300)

cor.test(SonDaughter$OneTouchP,SonDaughter$CT, method = "spearman", exact = FALSE)
SpearmanRho(SonDaughter$OneTouchP,SonDaughter$CT, conf.level = 0.95)
p13 <- SonDaughter %>%
  ggplot(aes(x=OneTouchP, y=CT, color = Child)) + 
  geom_point(shape = 21, size=2, position = "jitter", alpha = .5)+
  geom_smooth(method=lm, color="black", se=F) +
  labs(x="Proportion of 5-min Segment at Least One
       Caregiver is within Touching Distance", y="Conversational Turn Count") +
  theme(panel.background = element_rect(fill = "white"), 
        axis.title = element_text(family = "Arial", size=12, color = "black"), 
        axis.line = element_line(size = .5, colour = "black"), 
        axis.text = element_text(family = "Arial", size=10, color = "black"),
        aspect.ratio = 1)
CTprox <- p13
CTprox
ggsave("CTprox.png",
       plot = CTprox,
       dpi = 300)



```




# SUPPLEMENT
# remaining dyad plots
``` {r}

pS1a<-F1Day1 %>%
  filter(DyadF == "sondaughter") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "firebrick") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

pS1b<-F1Day2 %>%
  filter(DyadF == "sondaughter") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "brown2") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

#SuppF1sondau <- pS1a+pS1b
#SuppF1sondau
#ggsave("SuppF1sondauC20.png",
#       plot = SuppF1sondau,
#       dpi = 300)

pS2a<-F1Day1 %>%
  filter(DyadF == "momdad") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "dodgerblue4") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

pS2b<-F1Day2 %>%
  filter(DyadF == "momdad") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "steelblue3") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

#SuppF1momdad <- pS2a+pS2b
#SuppF1momdad
#ggsave("SuppF1momdadC20.png",
 #      plot = SuppF1momdad,
#       dpi = 300)

pS3a<-F2Day1 %>%
  filter(DyadF == "momdad") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "darkgoldenrod") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

pS3b<-F2Day2 %>%
  filter(DyadF == "momdad") %>%
  ggplot(aes(x = Time2, y = ProxC)) +
  geom_bar(stat = "identity", color = "darkgoldenrod2") +
  geom_hline(yintercept = 0) +
  scale_y_reverse(limits = c(20,0)) +
  theme(
    panel.background = element_rect(fill = "white"), 
    plot.title = element_text(size = 14, hjust = .5),
    axis.line = element_line(size = .5, colour = "black"), 
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  labs(x = "Time",
       y = "Proximity (Ft)")

#SuppF2momdad <- pS3a+pS3b
#SuppF2momdad
#ggsave("SuppF2momdadC20.png",
  #     plot = SuppF2momdad,
  #     dpi = 300)

#knit plots together
SuppPlots <- (pS1a + pS2a + pS3a) /
  (pS1b + pS2b + pS3b)  +
  plot_annotation(tag_levels = 'A')
SuppPlots
ggsave("SuppPlotsC20.png",
       plot = SuppPlots,
       dpi = 300)

```
# Descriptive Stats
```{r}
F1BothDaysWSupp <-
  F1BothDays %>%
  pivot_wider(
    id_cols = c(Day, Time),
    names_from = DyadF,
    values_from = c(Prox,ProxCF,ProxC),
    values_fill = NA
  ) %>%
  mutate(
    Day = as.numeric(Day),
    Time2 = as.POSIXct(Time, format = "%H:%M:%S"),
    MomDadTouch = if_else(Prox_momdad <= 3, 1, 0),
    SonDaughterTouch = if_else(Prox_sondaughter <= 3, 1, 0)) %>%
  mutate_at(vars(MomDadTouch:SonDaughterTouch), replace_na, 0)

F1StatsSupp <-
  F1BothDaysWSupp %>%
  group_by(Day) %>%
  summarize(
    MomDadMean = mean(Prox_momdad, na.rm = TRUE),
    SonDaughterMean = mean(Prox_sondaughter, na.rm = TRUE),
    MomDadMeanC = mean(ProxC_momdad, na.rm = TRUE),
    SonDaughterMeanC = mean(ProxC_sondaughter, na.rm = TRUE),
    MomDadCount = length(na.omit(Prox_momdad)),
    SonDaughterCount = length(na.omit(Prox_sondaughter)),
    MomDadCountC = length(na.omit(ProxC_momdad)),
    SonDaughterCountC = length(na.omit(ProxC_sondaughter)),
    MomDadTouch = sum(MomDadTouch),
    SonDaughterTouch = sum(SonDaughterTouch),
  ) %>%
  mutate(
    MomDadTimeTouch = MomDadTouch / 60,
    SonDaughterTimeTouch = SonDaughterTouch / 60,
    MomDadTouchP = MomDadTouch / 43200,
    SonDaughterTouchP = SonDaughterTouch / 43200,
    MomDadTouchPc = MomDadTouch / MomDadCount,
    SonDaughterTouchPc = SonDaughterTouch / SonDaughterCount,
    MomDadTouchPcC = MomDadTouch / MomDadCountC,
    SonDaughterTouchPcC = SonDaughterTouch / SonDaughterCountC
  )

F2BothDaysWSupp <-
  F2BothDays %>%
  pivot_wider(
    id_cols = c(Day, Time),
    names_from = DyadF,
    values_from = c(Prox,ProxCF,ProxC),
    values_fill = NA
  ) %>%
  mutate(
    Day = as.numeric(Day),
    Time2 = as.POSIXct(Time, format = "%H:%M:%S"),
    MomDadTouch = if_else(Prox_momdad <= 3, 1, 0)) %>%
  mutate_at(vars(MomDadTouch), replace_na, 0)

F2StatsSupp <-
  F2BothDaysWSupp %>%
  group_by(Day) %>%
  summarize(
    MomDadMean = mean(Prox_momdad, na.rm = TRUE),
    MomDadMeanC = mean(ProxC_momdad, na.rm = TRUE),
    MomDadCount = length(na.omit(Prox_momdad)),
    MomDadCountC = length(na.omit(ProxC_momdad)),
    MomDadTouch = sum(MomDadTouch)
  ) %>%
  mutate(
    MomDadTimeTouch = MomDadTouch / 60,
    MomDadTouchP = MomDadTouch / 43200,
    MomDadTouchPc = MomDadTouch / MomDadCount,
    MomDadTouchPcC = MomDadTouch / MomDadCountC
  )

```

# Correlations within each family
```{r}
#Family One
F1momlenaCF <- momlenaCF %>%
  filter(Family == 1)
cor.test(F1momlenaCF$Prox,F1momlenaCF$FAWC, method = "spearman", exact = FALSE)
SpearmanRho(F1momlenaCF$Prox,F1momlenaCF$FAWC, conf.level = 0.95)

cor.test(F1momlenaCF$ParentTouchP,F1momlenaCF$FAWC, method = "spearman", exact = FALSE)
SpearmanRho(F1momlenaCF$ParentTouchP,F1momlenaCF$FAWC, conf.level = 0.95)

F1dadlenaCF <- dadlenaCF %>%
  filter(Family ==1)
cor.test(F1dadlenaCF$Prox,F1dadlenaCF$MAWC, method = "spearman", exact = FALSE)
SpearmanRho(F1dadlenaCF$Prox,F1dadlenaCF$MAWC, conf.level = 0.95)
cor.test(F1dadlenaCF$ParentTouchP,F1dadlenaCF$MAWC, method = "spearman", exact = FALSE)
SpearmanRho(F1dadlenaCF$ParentTouchP,F1dadlenaCF$MAWC, conf.level = 0.95)

F1SD <- SonDaughter %>%
  filter(Family == 1)
cor.test(F1SD$OneTouchP,F1SD$CT, method = "spearman", exact = FALSE)
SpearmanRho(F1SD$OneTouchP,F1SD$CT, conf.level = 0.95)

#Family Two
F2momlenaCF <- momlenaCF %>%
  filter(Family == 2)
cor.test(F2momlenaCF$Prox,F2momlenaCF$FAWC, method = "spearman", exact = FALSE)
SpearmanRho(F2momlenaCF$Prox,F2momlenaCF$FAWC, conf.level = 0.95)

cor.test(F2momlenaCF$ParentTouchP,F2momlenaCF$FAWC, method = "spearman", exact = FALSE)
SpearmanRho(F2momlenaCF$ParentTouchP,F2momlenaCF$FAWC, conf.level = 0.95)

F2dadlenaCF <- dadlenaCF %>%
  filter(Family ==2)
cor.test(F2dadlenaCF$Prox,F2dadlenaCF$MAWC, method = "spearman", exact = FALSE)
SpearmanRho(F2dadlenaCF$Prox,F2dadlenaCF$MAWC, conf.level = 0.95)
cor.test(F2dadlenaCF$ParentTouchP,F2dadlenaCF$MAWC, method = "spearman", exact = FALSE)
SpearmanRho(F2dadlenaCF$ParentTouchP,F2dadlenaCF$MAWC, conf.level = 0.95)

F2SD <- SonDaughter %>%
  filter(Family == 2)
cor.test(F2SD$OneTouchP,F2SD$CT, method = "spearman", exact = FALSE)
SpearmanRho(F2SD$OneTouchP,F2SD$CT, conf.level = 0.95)
```

```{r}

comprox <- momlenaCF %>%
  select(ParentTouchP,
         Prox) %>%
  bind_rows(dadlenaCF %>%
              select(ParentTouchP,
                     Prox))

cor.test(comprox$ParentTouchP,comprox$Prox, method = "spearman", exact = FALSE)
SpearmanRho(comprox$ParentTouchP,comprox$Prox, conf.level = 0.95)
```